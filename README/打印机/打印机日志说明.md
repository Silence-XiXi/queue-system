# 打印机日志说明

## 日志文件位置

### 开发环境
- 日志文件：`queue-system/printer.log`（项目根目录）

### 打包环境
- 日志文件：`printer.log`（与可执行文件同目录）

### 自定义位置
可以通过环境变量 `PRINTER_LOG_PATH` 指定日志文件路径：
```powershell
$env:PRINTER_LOG_PATH="C:\logs\printer.log"
```

## 日志级别

日志记录器支持以下级别：

- **DEBUG**: 调试信息（如模拟打印、切刀功能检测等）
- **INFO**: 一般信息（如 DLL 加载成功、端口打开成功、打印成功等）
- **WARN**: 警告信息（如 DLL 加载失败、打印机重置失败等）
- **ERROR**: 错误信息（如端口打开失败、打印失败、查询状态失败等）

## 日志格式

每条日志包含以下信息：
- 时间戳（ISO 格式）
- 日志级别
- 日志消息
- 相关数据（JSON 格式，如果有）

示例：
```
[2024-01-01T12:00:00.000Z] [INFO ] 打印机 DLL 加载成功
{
  "dllPath": "C:\\path\\to\\CsnPrinterLibs.dll",
  "config": {
    "portType": "COM",
    "portName": "COM1",
    "baudrate": 9600
  }
}
```

## 日志轮转

- **最大文件大小**: 10MB
- **自动备份**: 当日志文件超过 10MB 时，会自动创建带时间戳的备份文件
- **备份保留**: 最多保留 5 个备份文件，旧的备份会自动删除

备份文件命名格式：`printer-YYYY-MM-DDTHH-mm-ss-sssZ.log`

## 查看日志

### Windows PowerShell
```powershell
# 查看最新日志
Get-Content printer.log -Tail 50

# 实时查看日志
Get-Content printer.log -Wait -Tail 20

# 搜索错误日志
Select-String -Path printer.log -Pattern "ERROR"
```

### Windows CMD
```cmd
# 查看最新日志
type printer.log | more

# 搜索错误日志
findstr "ERROR" printer.log
```

### 文本编辑器
直接用文本编辑器（如记事本、VS Code）打开 `printer.log` 文件即可查看。

## 常见日志信息

### 正常情况
- `打印机 DLL 加载成功` - DLL 加载正常
- `打印机端口打开成功` - 端口连接正常
- `打印机初始化成功` - 初始化完成
- `打印成功` - 打印操作成功

### 警告情况
- `打印机 DLL 加载失败，将使用模拟模式` - DLL 未加载，使用模拟模式
- `打印机重置失败，但继续执行` - 重置失败但不影响使用
- `打印机可能没有切刀功能` - 切刀功能不可用（不影响打印）

### 错误情况
- `打开打印机端口失败` - 端口连接失败，检查打印机连接和配置
- `打印失败` - 打印操作失败，查看详细错误信息
- `查询打印机状态失败` - 状态查询失败

## 故障排除

### 问题 1: 日志文件未创建
**可能原因**:
- 目录权限不足
- 磁盘空间不足

**解决方法**:
1. 检查目录权限，确保可写
2. 检查磁盘空间
3. 查看控制台是否有错误信息

### 问题 2: 日志文件过大
**解决方法**:
- 日志会自动轮转，超过 10MB 会自动创建备份
- 可以手动删除旧的备份文件
- 或设置 `PRINTER_LOG_PATH` 指向其他位置

### 问题 3: 日志文件位置找不到
**解决方法**:
1. 开发环境：查看项目根目录
2. 打包环境：查看可执行文件同目录
3. 或设置 `PRINTER_LOG_PATH` 环境变量指定路径

## 注意事项

1. **日志文件权限**: 确保程序有权限写入日志文件所在目录
2. **日志文件大小**: 定期清理旧的备份文件，避免占用过多磁盘空间
3. **敏感信息**: 日志中可能包含配置信息，注意保护隐私
4. **性能影响**: 日志写入是异步的，不会显著影响程序性能

