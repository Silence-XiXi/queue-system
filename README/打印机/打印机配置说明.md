# 打印机配置说明

## 配置文件位置

打印机配置文件为 `printer.config.json`，可以放在以下位置（按优先级）：

1. **可执行文件同目录**（打包环境推荐）
   - 例如：`dist/printer.config.json`

2. **项目根目录**（开发环境）
   - 例如：`queueSystem-server/printer.config.json`

## 配置优先级

配置的优先级从高到低：
1. **环境变量**（最高优先级）
2. **配置文件** (`printer.config.json`)
3. **默认值**（代码中的默认值）

## 配置参数说明

### 基本配置

| 参数 | 类型 | 说明 | 默认值 | 示例 |
|------|------|------|--------|------|
| `portType` | string | 端口类型 | `USB` | `COM`, `USB`, `LPT`, `PRN`, `TCP` |
| `portName` | string | 端口名称 | `USB001` | `COM1`, `USB001`, `LPT1`, `192.168.1.100` |
| `enabled` | boolean | 是否启用打印机 | `true` | `true` 或 `false` |

### 串口配置（当 `portType` 为 `COM` 时）

| 参数 | 类型 | 说明 | 默认值 | 可选值 |
|------|------|------|--------|--------|
| `baudrate` | number | 波特率 | `9600` | `9600`, `19200`, `38400`, `57600`, `115200` |
| `flowcontrol` | number | 流控制 | `0` | `0`=无流控, `1`=DsrDtr, `2`=CtsRts, `3`=Xon/Xoff |
| `parity` | number | 校验位 | `0` | `0`=无校验, `1`=奇校验, `2`=偶校验 |
| `databits` | number | 数据位 | `8` | `4`-`8` |
| `stopbits` | number | 停止位 | `0` | `0`=1位, `1`=1.5位, `2`=2位 |

### TCP 配置（当 `portType` 为 `TCP` 时）

| 参数 | 类型 | 说明 | 默认值 | 示例 |
|------|------|------|--------|------|
| `tcpPort` | number | TCP 端口号 | `9100` | `9100` |

## 配置示例

### 示例 1: USB 打印机（默认）

```json
{
  "portType": "USB",
  "portName": "USB001",
  "enabled": true
}
```

### 示例 2: 串口打印机（COM1, 9600波特率）

```json
{
  "portType": "COM",
  "portName": "COM1",
  "baudrate": 9600,
  "flowcontrol": 0,
  "parity": 0,
  "databits": 8,
  "stopbits": 0,
  "enabled": true
}
```

### 示例 3: 网络打印机

```json
{
  "portType": "TCP",
  "portName": "192.168.1.100",
  "tcpPort": 9100,
  "enabled": true
}
```

### 示例 4: 禁用打印机（使用模拟模式）

```json
{
  "enabled": false
}
```

## 使用方法

### 方法 1: 使用配置文件（推荐）

1. 复制示例配置文件：
   ```bash
   cp printer.config.json.example printer.config.json
   ```

2. 编辑 `printer.config.json`，修改为您的打印机配置

3. 重启服务器

### 方法 2: 使用环境变量（临时配置）

环境变量会覆盖配置文件中的设置：

**Windows PowerShell:**
```powershell
$env:PRINTER_PORT_TYPE="COM"
$env:PRINTER_PORT_NAME="COM1"
$env:PRINTER_BAUDRATE="9600"
```

**Windows CMD:**
```cmd
set PRINTER_PORT_TYPE=COM
set PRINTER_PORT_NAME=COM1
set PRINTER_BAUDRATE=9600
```

**Linux/Mac:**
```bash
export PRINTER_PORT_TYPE=COM
export PRINTER_PORT_NAME=COM1
export PRINTER_BAUDRATE=9600
```

## 端口类型说明

### 1. COM（串口）
- **适用场景**: 通过串口连接的打印机
- **端口名称示例**: `COM1`, `COM2`, `COM3` 等
- **需要配置**: 波特率、流控制、校验位等

### 2. USB
- **适用场景**: USB 连接的打印机
- **端口名称示例**: `USB001`, `USB002` 等
- **获取方法**: 在设备管理器中查看，或使用打印机工具枚举

### 3. LPT（并口）
- **适用场景**: 通过并口连接的打印机
- **端口名称示例**: `LPT1`, `LPT2` 等

### 4. PRN（打印驱动）
- **适用场景**: 通过 Windows 打印驱动连接的打印机
- **端口名称示例**: 打印机名称，如 `POS58 Printer`

### 5. TCP（网络打印）
- **适用场景**: 网络打印机
- **端口名称示例**: IP 地址，如 `192.168.1.100`
- **需要配置**: TCP 端口号（通常为 9100）

## 故障排除

### 问题 1: 配置文件未找到

**现象**: 控制台没有显示 "已加载打印机配置文件"

**解决方法**:
1. 确认 `printer.config.json` 文件存在
2. 检查文件路径是否正确
3. 检查文件权限（确保可读）

### 问题 2: 配置文件格式错误

**现象**: 启动时报 JSON 解析错误

**解决方法**:
1. 检查 JSON 格式是否正确（使用 JSON 验证工具）
2. 确保所有字符串都用双引号
3. 确保没有多余的逗号

### 问题 3: 配置不生效

**解决方法**:
1. 检查是否有环境变量覆盖了配置
2. 确认配置文件路径正确
3. 重启服务器

## 注意事项

1. **配置文件修改后需要重启服务器**才能生效
2. **环境变量的优先级高于配置文件**，如果设置了环境变量，配置文件中的对应项会被忽略
3. **打包环境**：将 `printer.config.json` 放在可执行文件同目录下
4. **开发环境**：将 `printer.config.json` 放在 `queueSystem-server` 目录下

